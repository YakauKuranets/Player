# –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò
# PLAYE PhotoLab - –ö—Ä–∏–º–∏–Ω–∞–ª–∏—Å—Ç–∏—á–µ—Å–∫–∞—è AI –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è
# –ì–∏–±—Ä–∏–¥–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ v2 - –ü–æ–ª–Ω–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–í–ï–†–°–ò–Ø –ü–õ–ê–ù–ê:** 1.0  
**–î–ê–¢–ê:** 16 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–¶–ï–õ–¨:** –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (78% –æ—Å—Ç–∞–≤—à–µ–π—Å—è —Ä–∞–±–æ—Ç—ã)  
**–ò–°–ü–û–õ–ù–ò–¢–ï–õ–¨:** AI Agent  
**–§–û–†–ú–ê–¢:** –°—Ç—Ä–æ–≥–æ–µ –ø–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

---

## üìã –û–ë–©–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–õ–ê–ù–ê

### –≠–¢–ê–ü–´ –í–´–ü–û–õ–ù–ï–ù–ò–Ø:

1. **–≠–¢–ê–ü 1: Smart Router –∏ –ì–∏–±—Ä–∏–¥–Ω–∞—è –û—Å–Ω–æ–≤–∞** (12 –∑–∞–¥–∞—á, 1-2 –Ω–µ–¥–µ–ª–∏)
2. **–≠–¢–ê–ü 2: –ú–æ–¥–µ–ª–∏ - –û—Ñ—Ñ–ª–∞–π–Ω –∏ –û–Ω–ª–∞–π–Ω –í–µ—Ä—Å–∏–∏** (15 –∑–∞–¥–∞—á, 2-3 –Ω–µ–¥–µ–ª–∏)
3. **–≠–¢–ê–ü 3: –û–±–ª–∞—á–Ω—ã–π Backend** (20 –∑–∞–¥–∞—á, 3-4 –Ω–µ–¥–µ–ª–∏)
4. **–≠–¢–ê–ü 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (10 –∑–∞–¥–∞—á, 2 –Ω–µ–¥–µ–ª–∏)

**–û–ë–©–ï–ï –ö–û–õ–ò–ß–ï–°–¢–í–û –ó–ê–î–ê–ß:** 57  
**–†–ê–°–ß–ï–¢–ù–û–ï –í–†–ï–ú–Ø:** 8-11 –Ω–µ–¥–µ–ª—å

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê –î–õ–Ø AI –ê–ì–ï–ù–¢–ê

### –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:

1. **–ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨**
   - –í—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ –°–¢–†–û–ì–û –ø–æ –ø–æ—Ä—è–¥–∫—É
   - –ù–ï –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ô –∑–∞–¥–∞—á–∏

2. **–í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø**
   - –ü–æ—Å–ª–µ –ö–ê–ñ–î–û–ô –∑–∞–¥–∞—á–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏
   - –ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –ø—Ä–æ—à–µ–ª - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
   - –§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

3. **–î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–ù–ò–ï**
   - –°–æ–∑–¥–∞–≤–∞—Ç—å —Ñ–∞–π–ª PROGRESS.md –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
   - –û—Ç–º–µ—á–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ —Å ‚úÖ
   - –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

4. **–û–¢–ö–ê–¢**
   - –î–µ–ª–∞—Ç—å git commit –ø–æ—Å–ª–µ –ö–ê–ñ–î–û–ô —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏
   - –§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞: "Task X.Y: [–Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏]"
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∑–∞–¥–∞—á–µ

5. **–ö–û–î –°–¢–ê–ô–õ**
   - –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∏–ª—å –∫–æ–¥–∞
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
   - –î–æ–±–∞–≤–ª—è—Ç—å TODO –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π

---

# –≠–¢–ê–ü 1: SMART ROUTER –ò –ì–ò–ë–†–ò–î–ù–ê–Ø –û–°–ù–û–í–ê
**–¶–µ–ª—å:** –ó–∞–≤–µ—Ä—à–∏—Ç—å –≥–∏–±—Ä–∏–¥–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (60% –æ—Å—Ç–∞–ª–æ—Å—å)  
**–ó–∞–¥–∞—á–∏:** 1.1 - 1.12  
**–í—Ä–µ–º—è:** 1-2 –Ω–µ–¥–µ–ª–∏

---

## –ó–ê–î–ê–ß–ê 1.1: –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å SmartRouter

### –û–ü–ò–°–ê–ù–ò–ï:
–°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å SmartRouter, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏ –æ–±–ª–∞—á–Ω—ã–º–∏ backend.

### –§–ê–ô–õ:
`src/router.js`

### –ö–û–î –î–õ–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:

```javascript
/*
 * Smart Router for hybrid mode switching.
 * 
 * –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç AI –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ (ONNX) –∏ –æ–±–ª–∞—á–Ω—ã–º
 * backend (PyTorch+CUDA) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
 */

/**
 * –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã —Ä–æ—É—Ç–µ—Ä–∞
 * @typedef {'auto'|'offline'|'online'} RouterMode
 * - auto: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
 * - offline: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
 * - online: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –æ–±–ª–∞—á–Ω—ã–π backend (—Å fallback –Ω–∞ offline)
 */

export class SmartRouter {
  constructor() {
    /** @type {RouterMode} */
    this.mode = 'auto';
    
    /** @type {boolean} */
    this.online = navigator.onLine;
    
    /** @type {string|null} */
    this.backendUrl = null; // –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–∑–∂–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
    
    /** @type {HTMLElement|null} */
    this.indicatorEl = null;
    
    /** @type {Array<Function>} */
    this.listeners = [];
    
    // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è —Å–µ—Ç–∏
    this._setupNetworkListeners();
  }

  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å URL –æ–±–ª–∞—á–Ω–æ–≥–æ backend
   * @param {string} url - URL API endpoint (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'http://localhost:8000/api')
   */
  setBackendUrl(url) {
    this.backendUrl = url;
  }

  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
   * @param {RouterMode} mode - –†–µ–∂–∏–º: 'auto', 'offline', –∏–ª–∏ 'online'
   */
  setMode(mode) {
    if (!['auto', 'offline', 'online'].includes(mode)) {
      console.error('Invalid mode:', mode);
      return;
    }
    this.mode = mode;
    this._notifyListeners();
    this._updateIndicator();
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
   * @returns {RouterMode}
   */
  getMode() {
    return this.mode;
  }

  /**
   * –ü–æ–ª—É—á–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º (—Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏)
   * @returns {'offline'|'online'}
   */
  getEffectiveMode() {
    if (this.mode === 'offline') {
      return 'offline';
    }
    
    if (this.mode === 'online') {
      // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª online, –Ω–æ —Å–µ—Ç–∏ –Ω–µ—Ç - fallback –Ω–∞ offline
      if (!this.online) {
        console.warn('Online mode requested but network unavailable. Falling back to offline.');
        return 'offline';
      }
      return 'online';
    }
    
    // –†–µ–∂–∏–º 'auto' - —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏
    return this.online ? 'online' : 'offline';
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–±–ª–∞—á–Ω–æ–≥–æ backend
   * @returns {Promise<boolean>}
   */
  async checkBackendAvailability() {
    if (!this.backendUrl || !this.online) {
      return false;
    }

    try {
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 3000); // 3s timeout

      const response = await fetch(`${this.backendUrl}/health`, {
        method: 'GET',
        signal: controller.signal
      });

      clearTimeout(timeoutId);
      return response.ok;
    } catch (err) {
      console.warn('Backend health check failed:', err.message);
      return false;
    }
  }

  /**
   * –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å AI –∑–∞–ø—Ä–æ—Å
   * @param {string} task - –¢–∏–ø –∑–∞–¥–∞—á–∏ ('faceEnhance', 'upscale', 'denoise', –∏ —Ç.–¥.)
   * @param {any} data - –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
   * @param {Object} options - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
   * @returns {Promise<any>} –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
   */
  async routeAiRequest(task, data, options = {}) {
    const effectiveMode = this.getEffectiveMode();
    
    console.log(`[SmartRouter] Routing task "${task}" in ${effectiveMode} mode`);

    if (effectiveMode === 'offline') {
      return this._routeToLocalModels(task, data, options);
    } else {
      // –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±–ª–∞—á–Ω—ã–π backend —Å fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
      try {
        return await this._routeToCloudBackend(task, data, options);
      } catch (err) {
        console.error('[SmartRouter] Cloud backend failed, falling back to local:', err);
        return this._routeToLocalModels(task, data, options);
      }
    }
  }

  /**
   * –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏ (ONNX)
   * @private
   */
  async _routeToLocalModels(task, data, options) {
    // –ò–º–ø–æ—Ä—Ç –±—É–¥–µ—Ç –ø–æ–∑–∂–µ –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–æ–¥–µ–ª—è–º–∏
    const { runLocalModel } = await import('./models/localRunner.js');
    return runLocalModel(task, data, options);
  }

  /**
   * –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –æ–±–ª–∞—á–Ω—ã–π backend
   * @private
   */
  async _routeToCloudBackend(task, data, options) {
    if (!this.backendUrl) {
      throw new Error('Backend URL not configured');
    }

    const endpoint = `${this.backendUrl}/ai/${task}`;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ data —ç—Ç–æ ImageData –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–µ
    let body;
    if (data instanceof ImageData) {
      // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ImageData –≤ Blob
      const canvas = document.createElement('canvas');
      canvas.width = data.width;
      canvas.height = data.height;
      const ctx = canvas.getContext('2d');
      ctx.putImageData(data, 0, 0);
      
      body = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
    } else if (data instanceof Blob || data instanceof File) {
      body = data;
    } else {
      // JSON payload
      body = JSON.stringify(data);
    }

    const response = await fetch(endpoint, {
      method: 'POST',
      headers: body instanceof Blob ? {} : { 'Content-Type': 'application/json' },
      body: body
    });

    if (!response.ok) {
      const error = await response.text();
      throw new Error(`Backend request failed: ${response.status} ${error}`);
    }

    // –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç content-type
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
      return response.json();
    } else if (contentType && contentType.startsWith('image/')) {
      const blob = await response.blob();
      return this._blobToImageData(blob);
    } else {
      return response.blob();
    }
  }

  /**
   * –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è Blob –≤ ImageData
   * @private
   */
  async _blobToImageData(blob) {
    const img = new Image();
    const url = URL.createObjectURL(blob);
    
    return new Promise((resolve, reject) => {
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        URL.revokeObjectURL(url);
        resolve(imageData);
      };
      img.onerror = reject;
      img.src = url;
    });
  }

  /**
   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
   * @param {HTMLElement} element
   */
  setIndicator(element) {
    this.indicatorEl = element;
    this._updateIndicator();
  }

  /**
   * –û–±–Ω–æ–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
   * @private
   */
  _updateIndicator() {
    if (!this.indicatorEl) return;

    const effectiveMode = this.getEffectiveMode();
    const icon = effectiveMode === 'online' ? 'üåê' : 'üîå';
    const text = effectiveMode === 'online' ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ—Ñ–ª–∞–π–Ω';
    
    this.indicatorEl.textContent = `${icon} ${text}`;
    this.indicatorEl.classList.toggle('online', effectiveMode === 'online');
    this.indicatorEl.classList.toggle('offline', effectiveMode === 'offline');
    
    // –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∂–∏–º–µ –µ—Å–ª–∏ –Ω–µ auto
    if (this.mode !== 'auto') {
      this.indicatorEl.title = `–†–µ–∂–∏–º: ${this.mode}`;
    } else {
      this.indicatorEl.title = '–†–µ–∂–∏–º: –∞–≤—Ç–æ';
    }
  }

  /**
   * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π —Å–µ—Ç–∏
   * @private
   */
  _setupNetworkListeners() {
    const updateOnline = () => {
      this.online = navigator.onLine;
      this._updateIndicator();
      this._notifyListeners();
    };

    window.addEventListener('online', updateOnline);
    window.addEventListener('offline', updateOnline);
  }

  /**
   * –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
   * @param {Function} callback - –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ–º–∞—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
   */
  subscribe(callback) {
    this.listeners.push(callback);
  }

  /**
   * –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∂–∏–º–∞
   * @param {Function} callback
   */
  unsubscribe(callback) {
    this.listeners = this.listeners.filter(cb => cb !== callback);
  }

  /**
   * –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
   * @private
   */
  _notifyListeners() {
    const effectiveMode = this.getEffectiveMode();
    this.listeners.forEach(cb => {
      try {
        cb({ mode: this.mode, effectiveMode, online: this.online });
      } catch (err) {
        console.error('Listener error:', err);
      }
    });
  }
}

// –°–æ–∑–¥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä —Ä–æ—É—Ç–µ—Ä–∞
export const smartRouter = new SmartRouter();

/**
 * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä —Å —ç–ª–µ–º–µ–Ω—Ç–æ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
 * @deprecated –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ smartRouter –Ω–∞–ø—Ä—è–º—É—é
 */
export function initSmartRouter(indicatorEl) {
  smartRouter.setIndicator(indicatorEl);
}
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –§–∞–π–ª `src/router.js` –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∫–ª–∞—Å—Å–æ–º SmartRouter
2. ‚úÖ –ö–ª–∞—Å—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `SmartRouter` –∏ `smartRouter` instance
3. ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
4. ‚úÖ –ö–æ–¥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ª–∏–Ω—Ç–µ—Ä–∞ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

### –¢–ï–°–¢:

```javascript
// –¢–µ—Å—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
import { smartRouter } from './src/router.js';

console.log('Test 1: Mode switching');
smartRouter.setMode('offline');
console.assert(smartRouter.getEffectiveMode() === 'offline', 'Offline mode failed');

smartRouter.setMode('auto');
console.log('Auto mode effective:', smartRouter.getEffectiveMode());

console.log('Test 2: Backend URL');
smartRouter.setBackendUrl('http://localhost:8000/api');
console.assert(smartRouter.backendUrl === 'http://localhost:8000/api', 'Backend URL failed');

console.log('‚úÖ All router tests passed');
```

### GIT COMMIT:
```bash
git add src/router.js
git commit -m "Task 1.1: Implement SmartRouter class with routing logic"
```

---

## –ó–ê–î–ê–ß–ê 1.2: –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

### –û–ü–ò–°–ê–ù–ò–ï:
–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–µ–ª–µ–∫—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã (–ê–≤—Ç–æ/–û—Ñ—Ñ–ª–∞–π–Ω/–û–Ω–ª–∞–π–Ω) –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend URL.

### –§–ê–ô–õ–´:
- `index.html` (–¥–æ–±–∞–≤–∏—Ç—å UI —ç–ª–µ–º–µ–Ω—Ç—ã)
- `styles.css` (—Å—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
- `src/main.js` (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π)

### –ö–û–î –î–õ–Ø index.html:

–ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º —Ä–µ–∂–∏–º–∞ (–≥–¥–µ `id="network-status"`) –∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ –Ω–µ–≥–æ:

```html
<!-- –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å id="network-status" -->
<div class="mode-selector-container">
  <label for="mode-selector">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã:</label>
  <select id="mode-selector" class="mode-selector">
    <option value="auto" selected>üîÑ –ê–≤—Ç–æ (–ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)</option>
    <option value="offline">üîå –¢–æ–ª—å–∫–æ –æ—Ñ—Ñ–ª–∞–π–Ω</option>
    <option value="online">üåê –¢–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω</option>
  </select>
</div>

<!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ backend (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ offline) -->
<div id="backend-settings" class="backend-settings">
  <label for="backend-url">Backend URL:</label>
  <input 
    type="text" 
    id="backend-url" 
    class="backend-url-input"
    placeholder="http://localhost:8000/api"
    value="http://localhost:8000/api"
  />
  <button id="test-backend" class="btn-secondary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
  <span id="backend-status" class="backend-status"></span>
</div>
```

### –ö–û–î –î–õ–Ø styles.css:

–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:

```css
/* Mode Selector */
.mode-selector-container {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px 0;
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

.mode-selector-container label {
  font-size: 12px;
  color: #a0aec0;
  font-weight: 500;
}

.mode-selector {
  padding: 6px 12px;
  background: #1a202c;
  color: #fff;
  border: 1px solid #2d3748;
  border-radius: 4px;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
}

.mode-selector:hover {
  border-color: #4299e1;
}

.mode-selector:focus {
  outline: none;
  border-color: #4299e1;
  box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

/* Backend Settings */
.backend-settings {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 10px 0;
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
}

.backend-settings.hidden {
  display: none;
}

.backend-settings label {
  font-size: 12px;
  color: #a0aec0;
  font-weight: 500;
}

.backend-url-input {
  flex: 1;
  padding: 6px 12px;
  background: #1a202c;
  color: #fff;
  border: 1px solid #2d3748;
  border-radius: 4px;
  font-size: 13px;
  font-family: 'Courier New', monospace;
}

.backend-url-input:focus {
  outline: none;
  border-color: #4299e1;
  box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.backend-status {
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 3px;
}

.backend-status.success {
  color: #48bb78;
  background: rgba(72, 187, 120, 0.1);
}

.backend-status.error {
  color: #f56565;
  background: rgba(245, 101, 101, 0.1);
}

.backend-status.testing {
  color: #4299e1;
  background: rgba(66, 153, 225, 0.1);
}

.btn-secondary {
  padding: 6px 12px;
  background: #2d3748;
  color: #fff;
  border: 1px solid #4a5568;
  border-radius: 4px;
  font-size: 13px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-secondary:hover {
  background: #4a5568;
  border-color: #718096;
}

.btn-secondary:active {
  transform: translateY(1px);
}

.btn-secondary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}
```

### –ö–û–î –î–õ–Ø src/main.js:

–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–µ–∫—Ü–∏—é —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ (–ø–æ—Å–ª–µ `elements.video = ...`):

```javascript
// –í –æ–±—ä–µ–∫—Ç elements –¥–æ–±–∞–≤–∏—Ç—å:
modeSelector: document.getElementById('mode-selector'),
backendUrlInput: document.getElementById('backend-url'),
testBackendButton: document.getElementById('test-backend'),
backendStatus: document.getElementById('backend-status'),
backendSettings: document.getElementById('backend-settings'),
```

–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ orchestrator:

```javascript
// –ò–º–ø–æ—Ä—Ç –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞
import { smartRouter } from './router.js';

// –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è orchestrator, –¥–æ–±–∞–≤–∏—Ç—å:

// ============================================================================
// MODE SELECTOR AND BACKEND SETTINGS
// ============================================================================

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º
const networkStatus = document.getElementById('network-status');
if (networkStatus) {
  smartRouter.setIndicator(networkStatus);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
if (elements.modeSelector) {
  elements.modeSelector.addEventListener('change', (e) => {
    const mode = e.target.value;
    smartRouter.setMode(mode);
    
    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend
    if (elements.backendSettings) {
      if (mode === 'offline') {
        elements.backendSettings.classList.add('hidden');
      } else {
        elements.backendSettings.classList.remove('hidden');
      }
    }
    
    console.log('[Mode] Changed to:', mode);
  });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è URL backend
if (elements.backendUrlInput) {
  elements.backendUrlInput.addEventListener('change', (e) => {
    const url = e.target.value.trim();
    if (url) {
      smartRouter.setBackendUrl(url);
      console.log('[Backend] URL set to:', url);
      
      // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
      localStorage.setItem('backendUrl', url);
    }
  });
  
  // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
  const savedUrl = localStorage.getItem('backendUrl');
  if (savedUrl) {
    elements.backendUrlInput.value = savedUrl;
    smartRouter.setBackendUrl(savedUrl);
  }
}

// –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ backend
if (elements.testBackendButton) {
  elements.testBackendButton.addEventListener('click', async () => {
    const statusEl = elements.backendStatus;
    const button = elements.testBackendButton;
    
    if (!statusEl) return;
    
    // UI feedback
    button.disabled = true;
    statusEl.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
    statusEl.className = 'backend-status testing';
    
    try {
      const available = await smartRouter.checkBackendAvailability();
      
      if (available) {
        statusEl.textContent = '‚úì –ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
        statusEl.className = 'backend-status success';
      } else {
        statusEl.textContent = '‚úó –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
        statusEl.className = 'backend-status error';
      }
    } catch (err) {
      statusEl.textContent = '‚úó –û—à–∏–±–∫–∞: ' + err.message;
      statusEl.className = 'backend-status error';
    } finally {
      button.disabled = false;
    }
    
    // –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç—É—Å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
      statusEl.textContent = '';
      statusEl.className = 'backend-status';
    }, 3000);
  });
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
smartRouter.subscribe((state) => {
  console.log('[SmartRouter] State changed:', state);
  
  // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  if (state.effectiveMode === 'offline' && state.mode === 'online') {
    console.warn('–û–±–ª–∞—á–Ω—ã–π —Ä–µ–∂–∏–º –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏.');
  }
});
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –ø–æ—è–≤–∏–ª—Å—è —Å–µ–ª–µ–∫—Ç–æ—Ä —Ä–µ–∂–∏–º–∞
2. ‚úÖ –°–µ–ª–µ–∫—Ç–æ—Ä –º–µ–Ω—è–µ—Ç —Ä–µ–∂–∏–º —Ä–æ—É—Ç–µ—Ä–∞
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ backend —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ
4. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" —Ä–∞–±–æ—Ç–∞–µ—Ç
5. ‚úÖ URL —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage

### –¢–ï–°–¢:

1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –£–≤–∏–¥–µ—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ "–¢–æ–ª—å–∫–æ –æ—Ñ—Ñ–ª–∞–π–Ω" - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ backend –¥–æ–ª–∂–Ω—ã —Å–∫—Ä—ã—Ç—å—Å—è
4. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ "–¢–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω" - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è
5. –í–≤–µ—Å—Ç–∏ URL –∏ –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ"
6. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É - URL –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è

### GIT COMMIT:
```bash
git add index.html styles.css src/main.js
git commit -m "Task 1.2: Add mode selector UI and backend settings"
```

---

## –ó–ê–î–ê–ß–ê 1.3: –°–æ–∑–¥–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É localRunner.js

### –û–ü–ò–°–ê–ù–ò–ï:
–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö ONNX –º–æ–¥–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Ä–æ—É—Ç–µ—Ä–æ–º.

### –§–ê–ô–õ:
`src/models/localRunner.js` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

### –ö–û–î:

```javascript
/**
 * Local AI Models Runner
 * 
 * –ú–æ–¥—É–ª—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è AI –∑–∞–¥–∞—á —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω—ã—Ö ONNX –º–æ–¥–µ–ª–µ–π.
 * –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –º–æ–¥–µ–ª—è–º –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.
 */

import { ensureAiWorker, initAiModel, runAiInference } from './loader.js';

/**
 * –†–µ–µ—Å—Ç—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
 * –ö–∞–∂–¥–∞—è –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç:
 * - path: –ø—É—Ç—å –∫ .onnx —Ñ–∞–π–ª—É
 * - preprocess: —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 * - postprocess: —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 */
const LOCAL_MODELS = {
  // Face Enhancement - –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞, –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –≠—Ç–∞–ø–µ 2
  faceEnhance: {
    path: '/models/gfpgan-light.onnx',
    available: false, // –ú–æ–¥–µ–ª—å –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞
    preprocess: preprocessImage,
    postprocess: postprocessImage
  },
  
  // Upscaling
  upscale: {
    path: '/models/realesrgan-x2.onnx',
    available: false,
    preprocess: preprocessImage,
    postprocess: postprocessImage
  },
  
  // Denoising
  denoise: {
    path: '/models/nafnet-light.onnx',
    available: false,
    preprocess: preprocessImage,
    postprocess: postprocessImage
  },
  
  // Object Detection - —É–∂–µ –µ—Å—Ç—å —á–µ—Ä–µ–∑ COCO-SSD
  detectObjects: {
    available: true,
    handler: detectObjectsLocal
  },
  
  // Face Detection - —É–∂–µ –µ—Å—Ç—å —á–µ—Ä–µ–∑ Face Detection API
  detectFaces: {
    available: true,
    handler: detectFacesLocal
  }
};

/**
 * –í—ã–ø–æ–ª–Ω–∏—Ç—å AI –∑–∞–¥–∞—á—É –ª–æ–∫–∞–ª—å–Ω–æ
 * @param {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @param {any} data - –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
 * @param {Object} options - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
 * @returns {Promise<any>} –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏
 */
export async function runLocalModel(task, data, options = {}) {
  const model = LOCAL_MODELS[task];
  
  if (!model) {
    throw new Error(`Unknown local task: ${task}`);
  }
  
  if (!model.available) {
    throw new Error(`Local model for task "${task}" is not available yet. Will be added in Stage 2.`);
  }
  
  console.log(`[LocalRunner] Running task: ${task}`);
  
  // –ï—Å–ª–∏ —É –º–æ–¥–µ–ª–∏ –µ—Å—Ç—å custom handler (–¥–ª—è —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π)
  if (model.handler) {
    return model.handler(data, options);
  }
  
  // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º ONNX pipeline
  return runOnnxModel(model, data, options);
}

/**
 * –í—ã–ø–æ–ª–Ω–∏—Ç—å ONNX –º–æ–¥–µ–ª—å
 * @private
 */
async function runOnnxModel(model, data, options) {
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏
  await initAiModel(model.path);
  
  // –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
  const preprocessed = model.preprocess(data, options);
  
  // –ò–Ω—Ñ–µ—Ä–µ–Ω—Å
  const output = await runAiInference(preprocessed.data, preprocessed.dims);
  
  // –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞
  const result = model.postprocess(output, preprocessed, options);
  
  return result;
}

/**
 * –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è ONNX –º–æ–¥–µ–ª–∏
 * @private
 */
function preprocessImage(imageData, options = {}) {
  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ImageData –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –º–æ–¥–µ–ª–∏
  const { width, height, data } = imageData;
  
  // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–∏–∫—Å–µ–ª–µ–π [0, 255] -> [0, 1] –∏–ª–∏ [-1, 1]
  const normalize = options.normalize || 'zero_one'; // 'zero_one' –∏–ª–∏ 'neg_one_one'
  const float32Data = new Float32Array(width * height * 3);
  
  for (let i = 0; i < width * height; i++) {
    const r = data[i * 4] / 255;
    const g = data[i * 4 + 1] / 255;
    const b = data[i * 4 + 2] / 255;
    
    if (normalize === 'neg_one_one') {
      float32Data[i * 3] = r * 2 - 1;
      float32Data[i * 3 + 1] = g * 2 - 1;
      float32Data[i * 3 + 2] = b * 2 - 1;
    } else {
      float32Data[i * 3] = r;
      float32Data[i * 3 + 1] = g;
      float32Data[i * 3 + 2] = b;
    }
  }
  
  return {
    data: float32Data,
    dims: { width, height, channels: 3 },
    original: imageData
  };
}

/**
 * –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–æ–¥–µ–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ –≤ ImageData
 * @private
 */
function postprocessImage(output, preprocessed, options = {}) {
  const { width, height } = preprocessed.dims;
  const { data: tensorData } = output;
  
  // –°–æ–∑–¥–∞—Ç—å ImageData
  const imageData = new ImageData(width, height);
  const { data } = imageData;
  
  // –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
  const normalize = options.normalize || 'zero_one';
  
  for (let i = 0; i < width * height; i++) {
    let r = tensorData[i * 3];
    let g = tensorData[i * 3 + 1];
    let b = tensorData[i * 3 + 2];
    
    if (normalize === 'neg_one_one') {
      r = (r + 1) / 2;
      g = (g + 1) / 2;
      b = (b + 1) / 2;
    }
    
    data[i * 4] = Math.round(Math.max(0, Math.min(255, r * 255)));
    data[i * 4 + 1] = Math.round(Math.max(0, Math.min(255, g * 255)));
    data[i * 4 + 2] = Math.round(Math.max(0, Math.min(255, b * 255)));
    data[i * 4 + 3] = 255; // Alpha
  }
  
  return imageData;
}

/**
 * –î–µ—Ç–µ–∫—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ (COCO-SSD)
 * @private
 */
async function detectObjectsLocal(imageData, options = {}) {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ blueprints/ai.js
  // TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ –¥–µ—Ç–µ–∫—Ü–∏–∏
  
  // –ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞
  console.warn('[LocalRunner] detectObjects: using existing COCO-SSD implementation');
  return [];
}

/**
 * –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü –ª–æ–∫–∞–ª—å–Ω–æ (Face Detection API)
 * @private
 */
async function detectFacesLocal(imageData, options = {}) {
  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–∑ blueprints/ai.js
  // TODO: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ –¥–µ—Ç–µ–∫—Ü–∏–∏
  
  // –ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞
  console.warn('[LocalRunner] detectFaces: using existing Face Detection API implementation');
  return [];
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
 * @param {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @returns {boolean}
 */
export function isLocalModelAvailable(task) {
  const model = LOCAL_MODELS[task];
  return model && model.available;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
 * @returns {Array<string>}
 */
export function getAvailableLocalModels() {
  return Object.keys(LOCAL_MODELS).filter(task => LOCAL_MODELS[task].available);
}
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω `src/models/localRunner.js`
2. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ runLocalModel, isLocalModelAvailable, getAvailableLocalModels
3. ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–µ—Å—Ç—Ä LOCAL_MODELS
4. ‚úÖ –§—É–Ω–∫—Ü–∏—è –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π

### –¢–ï–°–¢:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
import { runLocalModel, getAvailableLocalModels } from './src/models/localRunner.js';

console.log('Available local models:', getAvailableLocalModels());
// –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: ['detectObjects', 'detectFaces']

// –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—É—é –º–æ–¥–µ–ª—å
try {
  await runLocalModel('faceEnhance', {});
} catch (err) {
  console.log('Expected error:', err.message);
  // –î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –æ—à–∏–±–∫—É –æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
}

console.log('‚úÖ LocalRunner tests passed');
```

### GIT COMMIT:
```bash
git add src/models/localRunner.js
git commit -m "Task 1.3: Create localRunner module for local AI models"
```

---

## –ó–ê–î–ê–ß–ê 1.4: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ AI —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### –û–ü–ò–°–ê–ù–ò–ï:
–û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π AI blueprint (`src/blueprints/ai.js`) –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SmartRouter –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞ –º–æ–¥–µ–ª–µ–π.

### –§–ê–ô–õ:
`src/blueprints/ai.js`

### –ò–ó–ú–ï–ù–ï–ù–ò–Ø:

1. –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç —Ä–æ—É—Ç–µ—Ä–∞ –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞:

```javascript
import { smartRouter } from '../router.js';
```

2. –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø—É—Å–∫–∞ AI –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, `runFaceDetection` –∏–ª–∏ –ø–æ–¥–æ–±–Ω—ã–µ) –∏ –æ–±–µ—Ä–Ω—É—Ç—å –∏—Ö –≤ —Ä–æ—É—Ç–µ—Ä.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –ª–∏—Ü:**

–ù–∞–π—Ç–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é (–ø—Ä–∏–º–µ—Ä–Ω–æ —Å—Ç—Ä–æ–∫–∞ 150-200):

```javascript
// –°–¢–ê–†–´–ô –ö–û–î (–ø—Ä–∏–º–µ—Ä–Ω–æ):
async function runFaceDetection() {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞
  const faceDetector = new FaceDetector();
  const faces = await faceDetector.detect(bitmap);
  // ...
}
```

**–ó–ê–ú–ï–ù–ò–¢–¨ –ù–ê:**

```javascript
async function runFaceDetection() {
  try {
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
    const result = await smartRouter.routeAiRequest('detectFaces', {
      bitmap: bitmap, // –∏–ª–∏ imageData –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      options: {} // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
    
  } catch (err) {
    console.error('[AI] Face detection failed:', err);
    // Fallback –∏–ª–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  }
}
```

3. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è:
   - –î–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤ (`detectObjects`)
   - Super-resolution (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –õ—é–±—ã–µ –¥—Ä—É–≥–∏–µ AI —Ñ—É–Ω–∫—Ü–∏–∏

### –®–ê–ë–õ–û–ù –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø:

```javascript
// –î–û:
const result = await directModelCall(data);

// –ü–û–°–õ–ï:
const result = await smartRouter.routeAiRequest('taskName', data, options);
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –í—Å–µ AI —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç smartRouter.routeAiRequest
2. ‚úÖ –°—Ç–∞—Ä—ã–π –∫–æ–¥ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Å –ø–æ–º–µ—Ç–∫–æ–π // DEPRECATED
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã try-catch –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
4. ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### –¢–ï–°–¢:

1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –Ω–∞ "–û—Ñ—Ñ–ª–∞–π–Ω"
3. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é –ª–∏—Ü
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è localRunner
5. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ "–û–Ω–ª–∞–π–Ω" (–µ—Å–ª–∏ backend –¥–æ—Å—Ç—É–ø–µ–Ω)
6. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞ - –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å—Å—è backend

### GIT COMMIT:
```bash
git add src/blueprints/ai.js
git commit -m "Task 1.4: Integrate SmartRouter with AI blueprint"
```

---

## –ó–ê–î–ê–ß–ê 1.5: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª

### –û–ü–ò–°–ê–ù–ò–ï:
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (backend URL, —Ä–µ–∂–∏–º—ã, –∏ —Ç.–¥.)

### –§–ê–ô–õ:
`src/config.js` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

### –ö–û–î:

```javascript
/**
 * Application Configuration
 * 
 * –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
 * –ó–Ω–∞—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —á–µ—Ä–µ–∑ localStorage –∏–ª–∏ environment variables.
 */

/**
 * @typedef {Object} AppConfig
 * @property {Object} router - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–æ—É—Ç–µ—Ä–∞
 * @property {string} router.defaultMode - –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
 * @property {string} router.backendUrl - URL –æ–±–ª–∞—á–Ω–æ–≥–æ backend
 * @property {number} router.backendTimeout - Timeout –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ backend (ms)
 * @property {Object} models - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–µ–ª–µ–π
 * @property {Object} models.local - –õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏
 * @property {Object} models.cloud - –û–±–ª–∞—á–Ω—ã–µ –º–æ–¥–µ–ª–∏
 * @property {Object} storage - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
 * @property {string} storage.dbName - –ò–º—è IndexedDB –±–∞–∑—ã
 * @property {number} storage.dbVersion - –í–µ—Ä—Å–∏—è —Å—Ö–µ–º—ã –±–∞–∑—ã
 * @property {Object} features - –§–ª–∞–≥–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
 */

/** @type {AppConfig} */
const DEFAULT_CONFIG = {
  // Router settings
  router: {
    defaultMode: 'auto', // 'auto' | 'offline' | 'online'
    backendUrl: 'http://localhost:8000/api',
    backendTimeout: 30000, // 30 seconds
    healthCheckInterval: 60000, // 1 minute
  },
  
  // Model settings
  models: {
    local: {
      basePath: '/models',
      // –ú–æ–¥–µ–ª–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –≠—Ç–∞–ø–µ 2
      available: {
        gfpgan: {
          path: '/models/gfpgan-light.onnx',
          size: 350 * 1024 * 1024, // 350 MB
          version: '1.3.0'
        },
        realesrgan: {
          path: '/models/realesrgan-x2.onnx',
          size: 100 * 1024 * 1024, // 100 MB
          version: '2.0.0'
        },
        nafnet: {
          path: '/models/nafnet-light.onnx',
          size: 50 * 1024 * 1024, // 50 MB
          version: '1.0.0'
        }
      }
    },
    cloud: {
      endpoints: {
        faceEnhance: '/ai/face-enhance',
        upscale: '/ai/upscale',
        denoise: '/ai/denoise',
        detectFaces: '/ai/detect-faces',
        detectObjects: '/ai/detect-objects'
      }
    }
  },
  
  // Storage settings
  storage: {
    dbName: 'PlayePhotoLab',
    dbVersion: 1,
    stores: {
      cases: 'cases',
      models: 'models',
      cache: 'cache'
    }
  },
  
  // Feature flags
  features: {
    enableCloudBackend: true,
    enableModelCaching: true,
    enableBatchProcessing: true,
    enableSync: false, // –ë—É–¥–µ—Ç –≤–∫–ª—é—á–µ–Ω–æ –≤ –≠—Ç–∞–ø–µ 4
  },
  
  // Development settings
  dev: {
    enableDebugLogs: true,
    mockBackendDelay: 2000, // ms
  }
};

/**
 * –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
 * –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º–∏ –≤ localStorage
 * @returns {AppConfig}
 */
export function loadConfig() {
  const config = { ...DEFAULT_CONFIG };
  
  try {
    // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
    const saved = localStorage.getItem('appConfig');
    if (saved) {
      const parsed = JSON.parse(saved);
      // –ì–ª—É–±–æ–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤
      deepMerge(config, parsed);
    }
  } catch (err) {
    console.warn('[Config] Failed to load from localStorage:', err);
  }
  
  // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ environment (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
  if (typeof process !== 'undefined' && process.env) {
    if (process.env.BACKEND_URL) {
      config.router.backendUrl = process.env.BACKEND_URL;
    }
  }
  
  return config;
}

/**
 * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
 * @param {Partial<AppConfig>} updates - –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
 */
export function saveConfig(updates) {
  try {
    const current = loadConfig();
    const updated = { ...current, ...updates };
    localStorage.setItem('appConfig', JSON.stringify(updated));
    console.log('[Config] Saved to localStorage');
  } catch (err) {
    console.error('[Config] Failed to save:', err);
  }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
 * @param {string} path - –ü—É—Ç—å —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'router.backendUrl')
 * @param {any} defaultValue - –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
 * @returns {any}
 */
export function getConfigValue(path, defaultValue = null) {
  const config = loadConfig();
  const keys = path.split('.');
  let value = config;
  
  for (const key of keys) {
    if (value && typeof value === 'object' && key in value) {
      value = value[key];
    } else {
      return defaultValue;
    }
  }
  
  return value;
}

/**
 * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ
 * @param {string} path - –ü—É—Ç—å —á–µ—Ä–µ–∑ —Ç–æ—á–∫—É
 * @param {any} value - –ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
 */
export function setConfigValue(path, value) {
  const config = loadConfig();
  const keys = path.split('.');
  const lastKey = keys.pop();
  let target = config;
  
  for (const key of keys) {
    if (!(key in target) || typeof target[key] !== 'object') {
      target[key] = {};
    }
    target = target[key];
  }
  
  target[lastKey] = value;
  saveConfig(config);
}

/**
 * –°–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
 */
export function resetConfig() {
  localStorage.removeItem('appConfig');
  console.log('[Config] Reset to defaults');
}

/**
 * –ì–ª—É–±–æ–∫–æ–µ —Å–ª–∏—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
 * @private
 */
function deepMerge(target, source) {
  for (const key in source) {
    if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {
      if (!target[key]) target[key] = {};
      deepMerge(target[key], source[key]);
    } else {
      target[key] = source[key];
    }
  }
}

// –≠–∫—Å–ø–æ—Ä—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (read-only)
export { DEFAULT_CONFIG };
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω `src/config.js`
2. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ loadConfig, saveConfig, getConfigValue, setConfigValue
3. ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç DEFAULT_CONFIG —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
4. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage

### –¢–ï–°–¢:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
import { loadConfig, setConfigValue, getConfigValue } from './src/config.js';

const config = loadConfig();
console.log('Default config:', config);

setConfigValue('router.backendUrl', 'http://example.com/api');
const url = getConfigValue('router.backendUrl');
console.assert(url === 'http://example.com/api', 'Config value not set');

console.log('‚úÖ Config tests passed');
```

### GIT COMMIT:
```bash
git add src/config.js
git commit -m "Task 1.5: Add configuration module with localStorage persistence"
```

---

## –ó–ê–î–ê–ß–ê 1.6-1.12: [–û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 1]

_–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ü–ª–∞–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –µ—â–µ 6 –∑–∞–¥–∞—á –¥–ª—è –≠—Ç–∞–ø–∞ 1. –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ —è –ø–æ–∫–∞–∑–∞–ª –ø–µ—Ä–≤—ã–µ 5 –∑–∞–¥–∞—á –¥–µ—Ç–∞–ª—å–Ω–æ. –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –±—É–¥—É—Ç —Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ._

–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á –≠—Ç–∞–ø–∞ 1:

**1.6** - –û–±–Ω–æ–≤–∏—Ç—å Service Worker –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π  
**1.7** - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π  
**1.8** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É capabilities (WebGPU/WebGL/CPU)  
**1.9** - –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∂–∏–º–µ —Ä–∞–±–æ—Ç—ã  
**1.10** - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞  
**1.11** - –û–±–Ω–æ–≤–∏—Ç—å README —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π  
**1.12** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≠—Ç–∞–ø–∞ 1  

---

# –≠–¢–ê–ü 2: –ú–û–î–ï–õ–ò - –û–§–§–õ–ê–ô–ù –ò –û–ù–õ–ê–ô–ù –í–ï–†–°–ò–ò
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏ –æ–±–ª–∞—á–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ AI –º–æ–¥–µ–ª–µ–π (75% –æ—Å—Ç–∞–ª–æ—Å—å)  
**–ó–∞–¥–∞—á–∏:** 2.1 - 2.15  
**–í—Ä–µ–º—è:** 2-3 –Ω–µ–¥–µ–ª–∏

---

## –ó–ê–î–ê–ß–ê 2.1: –°–æ–∑–¥–∞—Ç—å registry –º–æ–¥–µ–ª–µ–π

### –û–ü–ò–°–ê–ù–ò–ï:
–°–æ–∑–¥–∞—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä AI –º–æ–¥–µ–ª–µ–π —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∏ –æ–±–ª–∞—á–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö.

### –§–ê–ô–õ:
`src/models/registry.js` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

### –ö–û–î:

```javascript
/**
 * AI Models Registry
 * 
 * –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö AI –º–æ–¥–µ–ª–µ–π.
 * –î–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é (ONNX) –∏ –æ–±–ª–∞—á–Ω—É—é (PyTorch) –≤–µ—Ä—Å–∏–∏.
 */

/**
 * @typedef {Object} ModelVersion
 * @property {string} name - –ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
 * @property {string} version - –í–µ—Ä—Å–∏—è
 * @property {string} [path] - –ü—É—Ç—å –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏
 * @property {string} [endpoint] - API endpoint –¥–ª—è –æ–±–ª–∞—á–Ω–æ–π –º–æ–¥–µ–ª–∏
 * @property {number} size - –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
 * @property {string} accuracy - –¢–æ—á–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, '85%', '99%')
 * @property {number} [maxFactor] - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä (–¥–ª—è –∞–ø—Å–∫–µ–π–ª–∞)
 * @property {Object} requirements - –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
 */

/**
 * @typedef {Object} ModelEntry
 * @property {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @property {string} description - –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @property {ModelVersion} offline - –û—Ñ—Ñ–ª–∞–π–Ω –≤–µ—Ä—Å–∏—è
 * @property {ModelVersion} online - –û–Ω–ª–∞–π–Ω –≤–µ—Ä—Å–∏—è
 */

/** @type {Record<string, ModelEntry>} */
export const MODEL_REGISTRY = {
  // ========================================================================
  // FACE ENHANCEMENT - –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏—Ü
  // ========================================================================
  faceEnhance: {
    task: 'faceEnhance',
    description: '–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –ª–∏—Ü–∞',
    
    offline: {
      name: 'GFPGAN-v1.3-light',
      version: '1.3.0',
      path: '/models/gfpgan-light.onnx',
      size: 350 * 1024 * 1024, // 350 MB
      accuracy: '85%',
      requirements: {
        minMemory: 2 * 1024 * 1024 * 1024, // 2 GB RAM
        preferredBackend: 'wasm', // 'wasm' | 'webgl' | 'webgpu'
      },
      metadata: {
        inputSize: [512, 512],
        outputSize: [512, 512],
        normalize: 'zero_one',
        channels: 3
      }
    },
    
    online: {
      name: 'RestoreFormer++',
      version: '2.0.0',
      endpoint: '/ai/face-enhance',
      size: 2 * 1024 * 1024 * 1024, // 2 GB
      accuracy: '99%',
      requirements: {
        gpu: 'CUDA',
        minVRAM: 4 * 1024 * 1024 * 1024 // 4 GB VRAM
      },
      metadata: {
        inputSize: [1024, 1024],
        outputSize: [1024, 1024],
        batchSize: 4
      }
    }
  },
  
  // ========================================================================
  // UPSCALE - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
  // ========================================================================
  upscale: {
    task: 'upscale',
    description: '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    
    offline: {
      name: 'Real-ESRGAN-x2',
      version: '2.0.0',
      path: '/models/realesrgan-x2.onnx',
      size: 100 * 1024 * 1024, // 100 MB
      accuracy: '88%',
      maxFactor: 2,
      requirements: {
        minMemory: 1 * 1024 * 1024 * 1024, // 1 GB RAM
        preferredBackend: 'wasm'
      },
      metadata: {
        tileSize: 256, // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ —Ç–∞–π–ª–∞–º –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        overlap: 16
      }
    },
    
    online: {
      name: 'Real-ESRGAN-x4',
      version: '2.1.0',
      endpoint: '/ai/upscale',
      size: 500 * 1024 * 1024, // 500 MB
      accuracy: '95%',
      maxFactor: 4,
      requirements: {
        gpu: 'CUDA',
        minVRAM: 6 * 1024 * 1024 * 1024 // 6 GB VRAM
      },
      metadata: {
        tileSize: 512,
        overlap: 32,
        batchSize: 2
      }
    }
  },
  
  // ========================================================================
  // DENOISE - –®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ
  // ========================================================================
  denoise: {
    task: 'denoise',
    description: '–£–¥–∞–ª–µ–Ω–∏–µ —à—É–º–∞ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
    
    offline: {
      name: 'NAFNet-light',
      version: '1.0.0',
      path: '/models/nafnet-light.onnx',
      size: 50 * 1024 * 1024, // 50 MB
      accuracy: '82%',
      requirements: {
        minMemory: 512 * 1024 * 1024, // 512 MB RAM
        preferredBackend: 'wasm'
      },
      metadata: {
        inputSize: [512, 512],
        levels: ['light', 'medium'] // –£—Ä–æ–≤–Ω–∏ —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏—è
      }
    },
    
    online: {
      name: 'NAFNet-heavy',
      version: '1.1.0',
      endpoint: '/ai/denoise',
      size: 400 * 1024 * 1024, // 400 MB
      accuracy: '94%',
      requirements: {
        gpu: 'CUDA',
        minVRAM: 4 * 1024 * 1024 * 1024 // 4 GB VRAM
      },
      metadata: {
        inputSize: [1024, 1024],
        levels: ['light', 'medium', 'heavy'],
        batchSize: 4
      }
    }
  },
  
  // ========================================================================
  // OBJECT DETECTION - –î–µ—Ç–µ–∫—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
  // ========================================================================
  detectObjects: {
    task: 'detectObjects',
    description: '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏',
    
    offline: {
      name: 'COCO-SSD',
      version: '2.2.2',
      path: null, // –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ TensorFlow.js CDN
      size: 50 * 1024 * 1024, // ~50 MB
      accuracy: '75%',
      requirements: {
        minMemory: 256 * 1024 * 1024 // 256 MB RAM
      },
      metadata: {
        classes: 80, // COCO dataset classes
        minScore: 0.5
      }
    },
    
    online: {
      name: 'YOLOv8-Large',
      version: '8.0.0',
      endpoint: '/ai/detect-objects',
      size: 300 * 1024 * 1024, // 300 MB
      accuracy: '92%',
      requirements: {
        gpu: 'CUDA',
        minVRAM: 2 * 1024 * 1024 * 1024 // 2 GB VRAM
      },
      metadata: {
        classes: 80,
        minScore: 0.3,
        batchSize: 8
      }
    }
  },
  
  // ========================================================================
  // FACE DETECTION - –î–µ—Ç–µ–∫—Ü–∏—è –ª–∏—Ü
  // ========================================================================
  detectFaces: {
    task: 'detectFaces',
    description: '–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ª–∏—Ü –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏',
    
    offline: {
      name: 'Face Detection API',
      version: 'browser',
      path: null, // –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π API –±—Ä–∞—É–∑–µ—Ä–∞
      size: 0,
      accuracy: '80%',
      requirements: {
        browser: ['chrome', 'edge'] // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ –≤–µ–∑–¥–µ
      },
      metadata: {
        maxDetections: 10,
        fastMode: true
      }
    },
    
    online: {
      name: 'RetinaFace',
      version: '1.0.0',
      endpoint: '/ai/detect-faces',
      size: 100 * 1024 * 1024, // 100 MB
      accuracy: '96%',
      requirements: {
        gpu: 'CUDA',
        minVRAM: 2 * 1024 * 1024 * 1024 // 2 GB VRAM
      },
      metadata: {
        maxDetections: 100,
        landmarks: 5, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫
        batchSize: 16
      }
    }
  }
};

/**
 * –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥–µ–ª–∏
 * @param {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @param {'offline'|'online'} mode - –†–µ–∂–∏–º
 * @returns {ModelVersion|null}
 */
export function getModelInfo(task, mode) {
  const entry = MODEL_REGISTRY[task];
  if (!entry) return null;
  return entry[mode] || null;
}

/**
 * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏
 * @param {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @param {'offline'|'online'} mode - –†–µ–∂–∏–º
 * @returns {Promise<boolean>}
 */
export async function checkModelAvailability(task, mode) {
  const model = getModelInfo(task, mode);
  if (!model) return false;
  
  if (mode === 'offline') {
    // –î–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ API
    if (model.path) {
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è .onnx —Ñ–∞–π–ª–∞
      try {
        const response = await fetch(model.path, { method: 'HEAD' });
        return response.ok;
      } catch {
        return false;
      }
    } else {
      // –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ API (Face Detection, COCO-SSD —á–µ—Ä–µ–∑ CDN)
      return true; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ –¥–æ—Å—Ç—É–ø–Ω—ã
    }
  } else {
    // –î–ª—è –æ–Ω–ª–∞–π–Ω –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è–µ–º endpoint
    // –≠—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ —á–µ—Ä–µ–∑ SmartRouter.checkBackendAvailability()
    return true; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ backend —Å–∞–º –ø—Ä–æ–≤–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
  }
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞—á
 * @returns {Array<string>}
 */
export function getAllTasks() {
  return Object.keys(MODEL_REGISTRY);
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤ —Ä–µ–∂–∏–º–µ
 * @param {'offline'|'online'} mode - –†–µ–∂–∏–º
 * @returns {Promise<Array<string>>}
 */
export async function getAvailableTasks(mode) {
  const tasks = getAllTasks();
  const available = [];
  
  for (const task of tasks) {
    const isAvailable = await checkModelAvailability(task, mode);
    if (isAvailable) {
      available.push(task);
    }
  }
  
  return available;
}

/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–∏—Å—Ç–µ–º–µ –¥–ª—è –º–æ–¥–µ–ª–∏
 * @param {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @param {'offline'|'online'} mode - –†–µ–∂–∏–º
 * @returns {Object|null}
 */
export function getModelRequirements(task, mode) {
  const model = getModelInfo(task, mode);
  return model ? model.requirements : null;
}

/**
 * –°—Ä–∞–≤–Ω–∏—Ç—å –º–æ–¥–µ–ª–∏ (–æ—Ñ—Ñ–ª–∞–π–Ω vs –æ–Ω–ª–∞–π–Ω)
 * @param {string} task - –ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
 * @returns {Object} –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
 */
export function compareModels(task) {
  const entry = MODEL_REGISTRY[task];
  if (!entry) return null;
  
  const { offline, online } = entry;
  
  return {
    task,
    description: entry.description,
    comparison: {
      size: {
        offline: formatBytes(offline.size),
        online: formatBytes(online.size),
        ratio: (online.size / offline.size).toFixed(1) + 'x'
      },
      accuracy: {
        offline: offline.accuracy,
        online: online.accuracy,
        diff: (parseFloat(online.accuracy) - parseFloat(offline.accuracy)).toFixed(1) + '%'
      },
      maxFactor: {
        offline: offline.maxFactor || 'N/A',
        online: online.maxFactor || 'N/A'
      }
    }
  };
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∞–π—Ç—ã –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥
 * @private
 */
function formatBytes(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return Math.round(bytes / Math.pow(k, i) * 10) / 10 + ' ' + sizes[i];
}
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω `src/models/registry.js`
2. ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤—Å–µ 5 –∑–∞–¥–∞—á —Å –æ—Ñ—Ñ–ª–∞–π–Ω –∏ –æ–Ω–ª–∞–π–Ω –≤–µ—Ä—Å–∏—è–º–∏
3. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ getModelInfo, checkModelAvailability, compareModels
4. ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —Ä–∞–∑–º–µ—Ä–∞—Ö, —Ç–æ—á–Ω–æ—Å—Ç–∏, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö

### –¢–ï–°–¢:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
import { MODEL_REGISTRY, getModelInfo, compareModels, getAllTasks } from './src/models/registry.js';

console.log('All tasks:', getAllTasks());
console.log('Face enhance offline:', getModelInfo('faceEnhance', 'offline'));
console.log('Upscale comparison:', compareModels('upscale'));

console.log('‚úÖ Registry tests passed');
```

### GIT COMMIT:
```bash
git add src/models/registry.js
git commit -m "Task 2.1: Create AI models registry with offline/online versions"
```

---

## –ó–ê–î–ê–ß–ê 2.2-2.15: [–û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 2]

–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á –≠—Ç–∞–ø–∞ 2:

**2.2** - –°–∫–∞—á–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å GFPGAN-light –º–æ–¥–µ–ª—å  
**2.3** - –°–∫–∞—á–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å Real-ESRGAN-x2 –º–æ–¥–µ–ª—å  
**2.4** - –°–∫–∞—á–∞—Ç—å –∏ –¥–æ–±–∞–≤–∏—Ç—å NAFNet-light –º–æ–¥–µ–ª—å  
**2.5** - –û–±–Ω–æ–≤–∏—Ç—å localRunner –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–µ—Å—Ç—Ä–æ–º  
**2.6** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è GFPGAN  
**2.7** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è Real-ESRGAN  
**2.8** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è NAFNet  
**2.9** - –î–æ–±–∞–≤–∏—Ç—å UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π  
**2.10** - –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π  
**2.11** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ IndexedDB  
**2.12** - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π  
**2.13** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ —Å UI  
**2.14** - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–µ–π  
**2.15** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≠—Ç–∞–ø–∞ 2  

---

# –≠–¢–ê–ü 3: –û–ë–õ–ê–ß–ù–´–ô BACKEND
**–¶–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å FastAPI —Å–µ—Ä–≤–µ—Ä —Å PyTorch –º–æ–¥–µ–ª—è–º–∏ (90% –æ—Å—Ç–∞–ª–æ—Å—å)  
**–ó–∞–¥–∞—á–∏:** 3.1 - 3.20  
**–í—Ä–µ–º—è:** 3-4 –Ω–µ–¥–µ–ª–∏

---

## –ó–ê–î–ê–ß–ê 3.1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å backend –ø—Ä–æ–µ–∫—Ç

### –û–ü–ò–°–ê–ù–ò–ï:
–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É Python –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –æ–±–ª–∞—á–Ω–æ–≥–æ backend.

### –§–ê–ô–õ–´:
–ù–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `backend/` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ face_enhance.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upscale.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ denoise.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ detect_faces.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ detect_objects.py
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py
‚îÇ   ‚îú‚îÄ‚îÄ queue/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ worker.py
‚îÇ   ‚îî‚îÄ‚îÄ db/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ models.py
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md
```

### –ö–û–î requirements.txt:

```txt
# Web Framework
fastapi==0.104.1
uvicorn[standard]==0.24.0
python-multipart==0.0.6

# Deep Learning
torch==2.1.0
torchvision==0.16.0
basicsr==1.4.2
facexlib==0.3.0
gfpgan==1.3.8
realesrgan==0.3.0

# Image Processing
opencv-python==4.8.1.78
pillow==10.1.0
numpy==1.24.3

# Database
sqlalchemy==2.0.23
psycopg2-binary==2.9.9

# Queue
celery==5.3.4
redis==5.0.1

# Utilities
python-dotenv==1.0.0
pydantic==2.5.0
```

### –ö–û–î backend/app/main.py:

```python
"""
PLAYE PhotoLab - Cloud Backend
FastAPI server for heavy AI processing
"""

from fastapi import FastAPI, File, UploadFile, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse
import torch
import logging
from typing import Optional

from app.config import settings
from app.api import routes

# Logging setup
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

# FastAPI app
app = FastAPI(
    title="PLAYE PhotoLab Backend",
    description="Cloud AI processing for forensic video analysis",
    version="1.0.0"
)

# CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# Include API routes
app.include_router(routes.router, prefix="/api")

@app.on_event("startup")
async def startup_event():
    """Initialize models and resources on startup"""
    logger.info("Starting PLAYE PhotoLab Backend...")
    
    # Check CUDA availability
    if torch.cuda.is_available():
        device = torch.device("cuda")
        logger.info(f"‚úÖ CUDA available: {torch.cuda.get_device_name(0)}")
        logger.info(f"   VRAM: {torch.cuda.get_device_properties(0).total_memory / 1024**3:.1f} GB")
    else:
        device = torch.device("cpu")
        logger.warning("‚ö†Ô∏è CUDA not available. Running on CPU (slow)")
    
    # Store device in app state
    app.state.device = device
    
    # Pre-load models (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    # await load_all_models()
    
    logger.info("‚úÖ Backend started successfully")

@app.on_event("shutdown")
async def shutdown_event():
    """Cleanup on shutdown"""
    logger.info("Shutting down backend...")
    # Cleanup models, close connections, etc.

@app.get("/")
async def root():
    """Root endpoint"""
    return {
        "service": "PLAYE PhotoLab Backend",
        "version": "1.0.0",
        "status": "running"
    }

@app.get("/api/health")
async def health_check():
    """Health check endpoint"""
    return {
        "status": "ok",
        "cuda_available": torch.cuda.is_available(),
        "device": str(app.state.device)
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(
        "app.main:app",
        host="0.0.0.0",
        port=8000,
        reload=True  # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    )
```

### –ö–û–î backend/app/config.py:

```python
"""
Configuration for backend
"""

from pydantic_settings import BaseSettings
from typing import Optional

class Settings(BaseSettings):
    # Server
    HOST: str = "0.0.0.0"
    PORT: int = 8000
    
    # Database
    DATABASE_URL: str = "postgresql://user:password@localhost:5432/playelab"
    
    # Redis (–¥–ª—è Celery)
    REDIS_URL: str = "redis://localhost:6379/0"
    
    # Models
    MODELS_DIR: str = "/models"
    
    # GPU
    CUDA_VISIBLE_DEVICES: Optional[str] = "0"
    
    # Processing
    MAX_IMAGE_SIZE: int = 4096  # Max dimension
    BATCH_SIZE: int = 4
    
    class Config:
        env_file = ".env"
        case_sensitive = True

settings = Settings()
```

### –ö–û–î backend/Dockerfile:

```dockerfile
FROM nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04

# Set working directory
WORKDIR /app

# Install Python
RUN apt-get update && apt-get install -y \
    python3.10 \
    python3-pip \
    libgl1-mesa-glx \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# Copy requirements
COPY requirements.txt .

# Install Python dependencies
RUN pip3 install --no-cache-dir -r requirements.txt

# Copy app
COPY app/ ./app/

# Download models (will be done in separate task)
# RUN python3 -m app.models.download

# Expose port
EXPOSE 8000

# Run server
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### –ö–û–î backend/docker-compose.yml:

```yaml
version: '3.8'

services:
  backend:
    build: .
    ports:
      - "8000:8000"
    environment:
      - CUDA_VISIBLE_DEVICES=0
      - DATABASE_URL=postgresql://playelab:password@postgres:5432/playelab
      - REDIS_URL=redis://redis:6379/0
    volumes:
      - ./app:/app/app
      - ./models:/models
    depends_on:
      - postgres
      - redis
    runtime: nvidia  # Requires nvidia-docker
    
  postgres:
    image: postgres:15
    environment:
      - POSTGRES_USER=playelab
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=playelab
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
  
  redis:
    image: redis:7
    ports:
      - "6379:6379"
  
  celery_worker:
    build: .
    command: celery -A app.queue.worker worker --loglevel=info
    environment:
      - CUDA_VISIBLE_DEVICES=0
      - DATABASE_URL=postgresql://playelab:password@postgres:5432/playelab
      - REDIS_URL=redis://redis:6379/0
    volumes:
      - ./app:/app/app
      - ./models:/models
    depends_on:
      - postgres
      - redis
    runtime: nvidia

volumes:
  postgres_data:
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `backend/` —Å–æ–∑–¥–∞–Ω–∞ —Å–æ –≤—Å–µ–º–∏ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏
2. ‚úÖ –§–∞–π–ª `requirements.txt` —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
3. ‚úÖ –§–∞–π–ª `main.py` —Å FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
4. ‚úÖ Dockerfile –∏ docker-compose.yml –≥–æ—Ç–æ–≤—ã
5. ‚úÖ Backend –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

### –¢–ï–°–¢:

```bash
cd backend
pip install -r requirements.txt
python -m app.main
# –û—Ç–∫—Ä—ã—Ç—å http://localhost:8000/docs
# –î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è Swagger UI —Å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
```

### GIT COMMIT:
```bash
git add backend/
git commit -m "Task 3.1: Initialize backend project structure with FastAPI"
```

---

## –ó–ê–î–ê–ß–ê 3.2-3.20: [–û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 3]

–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á –≠—Ç–∞–ø–∞ 3:

**3.2** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoint –¥–ª—è face enhance  
**3.3** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoint –¥–ª—è upscale  
**3.4** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoint –¥–ª—è denoise  
**3.5** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoint –¥–ª—è detect faces  
**3.6** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API endpoint –¥–ª—è detect objects  
**3.7** - –°–∫–∞—á–∞—Ç—å PyTorch –º–æ–¥–µ–ª–∏ (RestoreFormer++, Real-ESRGAN-x4)  
**3.8** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å RestoreFormer++ –¥–ª—è –ª–∏—Ü  
**3.9** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Real-ESRGAN –¥–ª—è –∞–ø—Å–∫–µ–π–ª–∞  
**3.10** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å NAFNet –¥–ª—è —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏—è  
**3.11** - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL —Å—Ö–µ–º—É  
**3.12** - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Celery –¥–ª—è batch –æ–±—Ä–∞–±–æ—Ç–∫–∏  
**3.13** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π  
**3.14** - –î–æ–±–∞–≤–∏—Ç—å rate limiting  
**3.15** - –î–æ–±–∞–≤–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (JWT)  
**3.16** - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  
**3.17** - –°–æ–∑–¥–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã  
**3.18** - Deployment –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏  
**3.19** - –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
**3.20** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≠—Ç–∞–ø–∞ 3  

---

# –≠–¢–ê–ü 4: –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ò –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø
**–¶–µ–ª—å:** –°–≤—è–∑–∞—Ç—å frontend –∏ backend, —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (85% –æ—Å—Ç–∞–ª–æ—Å—å)  
**–ó–∞–¥–∞—á–∏:** 4.1 - 4.10  
**–í—Ä–µ–º—è:** 2 –Ω–µ–¥–µ–ª–∏

---

## –ó–ê–î–ê–ß–ê 4.1: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è backend

### –û–ü–ò–°–ê–ù–ò–ï:
–°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±–ª–∞—á–Ω—ã–º backend API.

### –§–ê–ô–õ:
`src/api/client.js` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

### –ö–û–î:

```javascript
/**
 * API Client for Cloud Backend
 * 
 * HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å FastAPI backend.
 */

import { smartRouter } from '../router.js';
import { getConfigValue } from '../config.js';

/**
 * @typedef {Object} ApiResponse
 * @property {boolean} success
 * @property {any} [data]
 * @property {string} [error]
 */

/**
 * API Client –∫–ª–∞—Å—Å
 */
export class ApiClient {
  constructor(baseUrl = null) {
    this.baseUrl = baseUrl || getConfigValue('router.backendUrl', 'http://localhost:8000/api');
    this.timeout = getConfigValue('router.backendTimeout', 30000);
  }
  
  /**
   * –í—ã–ø–æ–ª–Ω–∏—Ç—å POST –∑–∞–ø—Ä–æ—Å —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
   * @param {string} endpoint - API endpoint (–Ω–∞–ø—Ä–∏–º–µ—Ä, '/ai/face-enhance')
   * @param {Blob|File|ImageData} image - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
   * @param {Object} options - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
   * @returns {Promise<ApiResponse>}
   */
  async postImage(endpoint, image, options = {}) {
    const formData = new FormData();
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è ImageData –≤ Blob –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    let blob = image;
    if (image instanceof ImageData) {
      blob = await this._imageDataToBlob(image);
    }
    
    formData.append('file', blob, 'image.png');
    
    // –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    if (options.params) {
      Object.keys(options.params).forEach(key => {
        formData.append(key, JSON.stringify(options.params[key]));
      });
    }
    
    return this._request(endpoint, {
      method: 'POST',
      body: formData
    });
  }
  
  /**
   * –í—ã–ø–æ–ª–Ω–∏—Ç—å GET –∑–∞–ø—Ä–æ—Å
   * @param {string} endpoint - API endpoint
   * @returns {Promise<ApiResponse>}
   */
  async get(endpoint) {
    return this._request(endpoint, { method: 'GET' });
  }
  
  /**
   * –í—ã–ø–æ–ª–Ω–∏—Ç—å POST –∑–∞–ø—Ä–æ—Å —Å JSON
   * @param {string} endpoint - API endpoint
   * @param {Object} data - JSON –¥–∞–Ω–Ω—ã–µ
   * @returns {Promise<ApiResponse>}
   */
  async post(endpoint, data) {
    return this._request(endpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
  }
  
  /**
   * –ë–∞–∑–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
   * @private
   */
  async _request(endpoint, options) {
    const url = `${this.baseUrl}${endpoint}`;
    
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), this.timeout);
    
    try {
      const response = await fetch(url, {
        ...options,
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      if (!response.ok) {
        const error = await response.text();
        return {
          success: false,
          error: `HTTP ${response.status}: ${error}`
        };
      }
      
      // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –æ—Ç–≤–µ—Ç–∞
      const contentType = response.headers.get('content-type');
      let data;
      
      if (contentType && contentType.includes('application/json')) {
        data = await response.json();
      } else if (contentType && contentType.startsWith('image/')) {
        const blob = await response.blob();
        data = await this._blobToImageData(blob);
      } else {
        data = await response.blob();
      }
      
      return {
        success: true,
        data
      };
      
    } catch (err) {
      clearTimeout(timeoutId);
      
      if (err.name === 'AbortError') {
        return {
          success: false,
          error: 'Request timeout'
        };
      }
      
      return {
        success: false,
        error: err.message
      };
    }
  }
  
  /**
   * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å ImageData –≤ Blob
   * @private
   */
  async _imageDataToBlob(imageData) {
    const canvas = document.createElement('canvas');
    canvas.width = imageData.width;
    canvas.height = imageData.height;
    const ctx = canvas.getContext('2d');
    ctx.putImageData(imageData, 0, 0);
    
    return new Promise((resolve) => {
      canvas.toBlob((blob) => resolve(blob), 'image/png');
    });
  }
  
  /**
   * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Blob –≤ ImageData
   * @private
   */
  async _blobToImageData(blob) {
    const img = new Image();
    const url = URL.createObjectURL(blob);
    
    return new Promise((resolve, reject) => {
      img.onload = () => {
        const canvas = document.createElement('canvas');
        canvas.width = img.width;
        canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        URL.revokeObjectURL(url);
        resolve(imageData);
      };
      img.onerror = reject;
      img.src = url;
    });
  }
}

// Singleton instance
export const apiClient = new ApiClient();

/**
 * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è AI endpoints
 */

export async function enhanceFace(imageData, options = {}) {
  return apiClient.postImage('/ai/face-enhance', imageData, { params: options });
}

export async function upscaleImage(imageData, factor = 2, options = {}) {
  return apiClient.postImage('/ai/upscale', imageData, { 
    params: { factor, ...options } 
  });
}

export async function denoiseImage(imageData, level = 'medium', options = {}) {
  return apiClient.postImage('/ai/denoise', imageData, { 
    params: { level, ...options } 
  });
}

export async function detectFaces(imageData, options = {}) {
  return apiClient.postImage('/ai/detect-faces', imageData, { params: options });
}

export async function detectObjects(imageData, options = {}) {
  return apiClient.postImage('/ai/detect-objects', imageData, { params: options });
}
```

### –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê:

1. ‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω `src/api/client.js`
2. ‚úÖ –ö–ª–∞—Å—Å ApiClient —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
3. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (enhanceFace, upscaleImage, –∏ —Ç.–¥.)
4. ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç—ã –∏ –æ—à–∏–±–∫–∏

### –¢–ï–°–¢:

```javascript
// –ü—Ä–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º backend
import { apiClient } from './src/api/client.js';

const health = await apiClient.get('/health');
console.log('Backend health:', health);

console.log('‚úÖ API client tests passed');
```

### GIT COMMIT:
```bash
git add src/api/client.js
git commit -m "Task 4.1: Implement HTTP client for cloud backend"
```

---

## –ó–ê–î–ê–ß–ê 4.2-4.10: [–û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≠—Ç–∞–ø–∞ 4]

–ö—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–¥–∞—á –≠—Ç–∞–ø–∞ 4:

**4.2** - –û–±–Ω–æ–≤–∏—Ç—å SmartRouter –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API client  
**4.3** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CloudStorage –∫–ª–∞—Å—Å  
**4.4** - –î–æ–±–∞–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–µ–ª (cases)  
**4.5** - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å conflict resolution  
**4.6** - –î–æ–±–∞–≤–∏—Ç—å UI –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏  
**4.7** - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å batch –æ–±—Ä–∞–±–æ—Ç–∫—É  
**4.8** - E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ  
**4.9** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ README  
**4.10** - –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞  

---

# –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

## –ü–†–ò–õ–û–ñ–ï–ù–ò–ï A: –§–æ—Ä–º–∞—Ç PROGRESS.md

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `PROGRESS.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```markdown
# PROGRESS LOG

## –≠–¢–ê–ü 1: Smart Router –∏ –ì–∏–±—Ä–∏–¥–Ω–∞—è –û—Å–Ω–æ–≤–∞
- [‚úÖ] 1.1: –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å SmartRouter
- [ ] 1.2: –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
- [ ] 1.3: –°–æ–∑–¥–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É localRunner.js
...

## –≠–¢–ê–ü 2: –ú–æ–¥–µ–ª–∏
- [ ] 2.1: –°–æ–∑–¥–∞—Ç—å registry –º–æ–¥–µ–ª–µ–π
...

## –≠–¢–ê–ü 3: –û–±–ª–∞—á–Ω—ã–π Backend
- [ ] 3.1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å backend –ø—Ä–æ–µ–∫—Ç
...

## –≠–¢–ê–ü 4: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
- [ ] 4.1: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HTTP –∫–ª–∏–µ–Ω—Ç
...

---

## NOTES

### 16.02.2026
- –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –ø–æ –ø–ª–∞–Ω—É
- –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞–¥–∞—á–∞ 1.1

### 17.02.2026
...
```

## –ü–†–ò–õ–û–ñ–ï–ù–ò–ï B: Git Workflow

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:

```bash
# 1. –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
git checkout -b task-X.Y

# 2. –°–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
# ... –∫–æ–¥ ...

# 3. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add .
git commit -m "Task X.Y: [–æ–ø–∏—Å–∞–Ω–∏–µ]"

# 4. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ main
git checkout main
git merge task-X.Y

# 5. –£–¥–∞–ª–∏—Ç—å –≤–µ—Ç–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
git branch -d task-X.Y
```

### –§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–æ–≤:

```
Task X.Y: [–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]

[–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ]

Checklist:
- [x] –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] –¢–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
```

## –ü–†–ò–õ–û–ñ–ï–ù–ò–ï C: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç-—á–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:

1. **–ö–æ–º–ø–∏–ª—è—Ü–∏—è**
   - [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - [ ] –ù–µ—Ç TypeScript –æ—à–∏–±–æ–∫ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
   - [ ] –õ–∏–Ω—Ç–µ—Ä –Ω–µ –≤—ã–¥–∞–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

2. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
   - [ ] –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
   - [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π (—Å—Ç–∞—Ä—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç)

3. **UI** (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
   - [ ] –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - [ ] Responsive –¥–∏–∑–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] –ù–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - [ ] –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
   - [ ] –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è UI
   - [ ] –ü—Ä–∏–µ–º–ª–µ–º–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞

## –ü–†–ò–õ–û–ñ–ï–ù–ò–ï D: Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

**–ü—Ä–æ–±–ª–µ–º–∞:** CORS –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ backend  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CORS middleware –≤ backend/app/main.py

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–¥–µ–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç–∏ –≤ registry.js –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** SmartRouter –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º—ã  
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ setMode –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ effectiveMode –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

# –§–ò–ù–ê–õ–¨–ù–´–ô –ß–ï–ö–õ–ò–°–¢

## –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:
- [ ] –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤–µ—Å—å –ø–ª–∞–Ω
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- [ ] –°–æ–∑–¥–∞—Ç—å PROGRESS.md
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–±–æ—á–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

## –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–µ—Å—Ç—ã –∏–∑ –∑–∞–¥–∞—á–∏
- [ ] –°–¥–µ–ª–∞—Ç—å git commit
- [ ] –û–±–Ω–æ–≤–∏—Ç—å PROGRESS.md
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

## –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞:
- [ ] –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏ —ç—Ç–∞–ø–∞
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å git tag (–Ω–∞–ø—Ä–∏–º–µ—Ä, v1.0-stage1)

## –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –ø–ª–∞–Ω–∞:
- [ ] –í—Å–µ 57 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ü–æ–ª–Ω–æ–µ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞
- [ ] –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

---

**–£–î–ê–ß–ò –í –†–ï–ê–õ–ò–ó–ê–¶–ò–ò! üöÄ**

